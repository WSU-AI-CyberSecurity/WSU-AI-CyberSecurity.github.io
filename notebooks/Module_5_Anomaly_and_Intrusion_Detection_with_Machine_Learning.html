
<!DOCTYPE html>


<html lang="en" data-content_root="../" data-theme="light">

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Module 5: Anomaly and Intrusion Detection with Machine Learning &#8212; WSU ML in Cybersecurity</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "light";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=c72df8c4" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=afe5de03"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/Module_5_Anomaly_and_Intrusion_Detection_with_Machine_Learning';</script>
    <script src="../_static/custom.js?v=a4c55d5e"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Module 6: Generative AI for Cyber Security" href="Module_6_Generative_AI_for_Cyber_Security.html" />
    <link rel="prev" title="Module 4: Unsupervised Learning" href="Module_4_Unsupervised_Learning.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="light">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="WSU ML in Cybersecurity - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="WSU ML in Cybersecurity - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Exploring Machine Learning in Cybersecurity Workshop
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Module_0_Introduction_to_Jupyter_Notebook_and_Colab.html"><strong>Module 0:</strong> Introduction to Jupyter Notebook and Colab</a></li>



<li class="toctree-l1"><a class="reference internal" href="Module_1_Fundamentals_of_Machine_Learning.html"><strong>Module 1:</strong> Fundamentals of Machine Learning</a></li>

<li class="toctree-l1"><a class="reference internal" href="Module_2_Supervised_learning.html"><strong>Module 2:</strong> Supervised Learning</a></li>




<li class="toctree-l1"><a class="reference internal" href="Module_3_Data_preprocessing_and_features_selection.html"><strong>Module 3:</strong> Data Preprocessing and Features Selection</a></li>
<li class="toctree-l1"><a class="reference internal" href="Module_4_Unsupervised_Learning.html"><strong>Module 4</strong>: Unsupervised Learning</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#"><strong>Module 5:</strong> Anomaly and Intrusion Detection with Machine Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="Module_6_Generative_AI_for_Cyber_Security.html"><strong>Module 6:</strong> Generative AI for Cyber Security</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://colab.research.google.com/github/WSU-AI-CyberSecurity/WSU-AI-CyberSecurity.github.io/blob/main/notebooks/Module_5_Anomaly_and_Intrusion_Detection_with_Machine_Learning.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onColab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/Module_5_Anomaly_and_Intrusion_Detection_with_Machine_Learning.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Module 5: Anomaly and Intrusion Detection with Machine Learning</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-we-need-anomaly-detection-in-cyber-security">Why do we need anomaly detection in Cyber Security?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#technical-explanation">Technical Explanation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#real-time-anomaly-detection">Real-Time Anomaly Detection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-detecting-intrusion-with-machine-learning">Case Study: Detecting Intrusion with Machine Learning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">Data preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#undersampling-against-unbalance">Undersampling against unbalance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-data-for-training">Preparing data for training</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importance">Feature importance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-the-decision-tree-importance-evaluation-using-a-single-tree-decisiontreeclassifier">Visualization of the decision tree, importance evaluation using a single tree (DecisionTreeClassifier)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importance-evaluation-using-selectfrommodel">Importance evaluation using SelectFromModel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-of-importance-using-randomforestclassifier-feature-importances">Evaluation of importance using RandomForestClassifier.feature_importances_</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-selected-features">Analysis of selected features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperparameter-selection">Hyperparameter selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-model">Final model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-approbation">Model approbation</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="module-5-anomaly-and-intrusion-detection-with-machine-learning">
<h1><strong>Module 5:</strong> Anomaly and Intrusion Detection with Machine Learning<a class="headerlink" href="#module-5-anomaly-and-intrusion-detection-with-machine-learning" title="Link to this heading">#</a></h1>
<section id="why-do-we-need-anomaly-detection-in-cyber-security">
<h2>Why do we need anomaly detection in Cyber Security?<a class="headerlink" href="#why-do-we-need-anomaly-detection-in-cyber-security" title="Link to this heading">#</a></h2>
<p>Detecting and mitigating zero-day vulnerabilities is crucial for maintaining robust cybersecurity. A zero-day vulnerability represents a hidden weakness in a computer system, exploitable by attackers and undetected by affected parties. To comprehend the potential impact, consider the scenario where an organization falls victim to a zero-day exploit.</p>
<center>
    <img style="max-width: 670px" src="https://raw.githubusercontent.com/WSU-AI-CyberSecurity/WSU-AI-CyberSecurity.github.io/main/assets/m5_anomaly.png" />
</center>
<p>Identifying abnormal network behavior is instrumental in fortifying organizations against zero-day attacks. This document provides insights into various approaches to achieve effective anomaly detection.</p>
</section>
<section id="technical-explanation">
<h2>Technical Explanation<a class="headerlink" href="#technical-explanation" title="Link to this heading">#</a></h2>
<p>Anomaly detection, also known as outlier detection, involves recognizing unexpected events, observations, or items that significantly deviate from the norm. Anomalous data can often be easily identified by breaking established rules, such as exceeding predefined thresholds.</p>
<p><strong>Properties of Anomaly</strong></p>
<ul class="simple">
<li><p>Anomalies in data occur infrequently.</p></li>
<li><p>Features of data anomalies are markedly different from those of normal instances.</p></li>
</ul>
<center>
    <img style="max-width: 800px" src="https://raw.githubusercontent.com/WSU-AI-CyberSecurity/WSU-AI-CyberSecurity.github.io/main/assets/m5_1.png" />
</center>
<p><strong>Examples of Anomalies:</strong></p>
<ul class="simple">
<li><p>Network anomalies (e.g., intrusion detection forecasting)</p></li>
<li><p>Application performance anomalies</p></li>
<li><p>Web application security anomalies (e.g., XSS attacks, DDoS attacks, unexpected login attempts)</p></li>
</ul>
<p><em>Refer below time series graph which shows unexpected drop in network usage (anomalous behaviour):</em></p>
<center>
    <img style="max-width: 800px" src="https://raw.githubusercontent.com/WSU-AI-CyberSecurity/WSU-AI-CyberSecurity.github.io/main/assets/m5_2.png" />
</center>
<p><strong>Challenges in Anomaly Detection:</strong></p>
<ul class="simple">
<li><p>Defining normal behavior</p></li>
<li><p>Handling imbalanced distribution of normal and abnormal data</p></li>
<li><p>Sparse occurrence of abnormal events</p></li>
<li><p>Appropriate feature extraction</p></li>
<li><p>Handling noise (distinct from anomalies)</p></li>
<li><p>Future anomalies may differ significantly from training set examples.</p></li>
</ul>
<p><strong>Testing for Anomalous Points:</strong></p>
<ul class="simple">
<li><p>Supervised training requires labeled anomalous data points.</p></li>
<li><p>Unsupervised learning relies on distances or cluster densities to estimate normalcy and outliers.</p></li>
<li><p>Feature Selection Criteria:</p></li>
<li><p>Choose features that exhibit unusually high or low values during anomaly events.</p></li>
</ul>
<section id="real-time-anomaly-detection">
<h3>Real-Time Anomaly Detection<a class="headerlink" href="#real-time-anomaly-detection" title="Link to this heading">#</a></h3>
<p>In communication networks, real-time processing is vital for detecting correlated traffic indicative of anomalous behavior, such as DDoS or zero-day attacks.</p>
<center>
    <img style="max-width: 800px" src="https://raw.githubusercontent.com/WSU-AI-CyberSecurity/WSU-AI-CyberSecurity.github.io/main/assets/m5_3.png" />
</center>
<p><strong>Performance Evaluation Criteria:</strong>
Given class imbalance, accuracy may not be a reliable metric. Confusion matrix analysis is recommended for a more nuanced evaluation.</p>
<p><strong>Applications:</strong>
Anomaly-based network intrusion detection system, credit card fraud detection, and malware detection are among the diverse applications. Practical examples and demonstrations, including a zero-day attack demo, are available in the provided resources.</p>
<p><em>In below picture, red points indicates anomaly based on previously seen data points.</em></p>
<center>
    <img style="max-width: 800px" src="https://raw.githubusercontent.com/WSU-AI-CyberSecurity/WSU-AI-CyberSecurity.github.io/main/assets/m5_4.png" />
</center>
<p><strong>Noise Filtering:</strong>
Prior to applying anomaly detection techniques, noise filtering is essential to reduce false positives. A recommended approach is discussed in the referenced paper.</p>
</section>
</section>
<section id="case-study-detecting-intrusion-with-machine-learning">
<h2>Case Study: Detecting Intrusion with Machine Learning<a class="headerlink" href="#case-study-detecting-intrusion-with-machine-learning" title="Link to this heading">#</a></h2>
<p>Training data: “Intrusion Detection Evaluation Dataset” (CICIDS2017). Description page: <a class="reference external" href="https://www.unb.ca/cic/datasets/ids-2017.html">https://www.unb.ca/cic/datasets/ids-2017.html</a></p>
<p>The data set is public. Download link: <a class="reference external" href="http://205.174.165.80/CICDataset/CIC-IDS-2017/Dataset/">http://205.174.165.80/CICDataset/CIC-IDS-2017/Dataset/</a></p>
<p>CICIDS2017 combines 8 files recorded on different days of observation (PCAP + CSV). Used archive: <a class="reference external" href="http://205.174.165.80/CICDataset/CIC-IDS-2017/Dataset/GeneratedLabelledFlows.zip">http://205.174.165.80/CICDataset/CIC-IDS-2017/Dataset/GeneratedLabelledFlows.zip</a></p>
<p>In the downloaded archive GeneratedLabelledFlows.zip the file “Thursday” Thursday-WorkingHours-Morning-WebAttacks.pcap_ISCX.csv is selected.</p>
<p>Sources:</p>
<ul class="simple">
<li><p>[Sharafaldin2018] Iman Sharafaldin, Arash Habibi Lashkari and Ali A. Ghorbani. Toward Generating a New Intrusion Detection Dataset and Intrusion Traffic Characterization. 2018</p></li>
<li><p>[Kostas2018] Kahraman Kostas. Anomaly Detection in Networks Using Machine Learning. 2018 (error was found in assessing the importance of features)</p></li>
<li><p><a class="github reference external" href="https://github.com/bozbil/Anomaly-Detection-in-Networks-Using-Machine-Learning">bozbil/Anomaly-Detection-in-Networks-Using-Machine-Learning</a> (error was found in assessing the importance of features)</p></li>
</ul>
</section>
<section id="data-preprocessing">
<h2>Data preprocessing<a class="headerlink" href="#data-preprocessing" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">preprocessing</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<p>Download the dataset from Github to Google Colab and unzip it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>graphviz
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: graphviz in /home/soraxas/micromamba/envs/wsu/lib/python3.9/site-packages (0.20.1)
</pre></div>
</div>
</div>
</div>
<p>We use “engine=python” to avoid the “UnicodeDecodeError: ‘utf-8’ codec can’t decode byte 0x96 in position 11: invalid start byte” encoding error.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;https://raw.githubusercontent.com/WSU-AI-CyberSecurity/data/master/CICIDS2017-thursday.pcap_ISCX.csv&quot;</span><span class="p">,</span>
    <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;cp1252&quot;</span><span class="p">,</span>
    <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Flow ID</th>
      <th>Source IP</th>
      <th>Source Port</th>
      <th>Destination IP</th>
      <th>Destination Port</th>
      <th>Protocol</th>
      <th>Timestamp</th>
      <th>Flow Duration</th>
      <th>Total Fwd Packets</th>
      <th>Total Backward Packets</th>
      <th>...</th>
      <th>min_seg_size_forward</th>
      <th>Active Mean</th>
      <th>Active Std</th>
      <th>Active Max</th>
      <th>Active Min</th>
      <th>Idle Mean</th>
      <th>Idle Std</th>
      <th>Idle Max</th>
      <th>Idle Min</th>
      <th>Label</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>192.168.10.3-192.168.10.50-389-33898-6</td>
      <td>192.168.10.50</td>
      <td>33898</td>
      <td>192.168.10.3</td>
      <td>389</td>
      <td>6</td>
      <td>6/7/2017 8:59</td>
      <td>113095465</td>
      <td>48</td>
      <td>24</td>
      <td>...</td>
      <td>32</td>
      <td>203985.500</td>
      <td>5.758373e+05</td>
      <td>1629110.0</td>
      <td>379.0</td>
      <td>13800000.0</td>
      <td>4.277541e+06</td>
      <td>16500000.0</td>
      <td>6737603.0</td>
      <td>BENIGN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>192.168.10.3-192.168.10.50-389-33904-6</td>
      <td>192.168.10.50</td>
      <td>33904</td>
      <td>192.168.10.3</td>
      <td>389</td>
      <td>6</td>
      <td>6/7/2017 8:59</td>
      <td>113473706</td>
      <td>68</td>
      <td>40</td>
      <td>...</td>
      <td>32</td>
      <td>178326.875</td>
      <td>5.034269e+05</td>
      <td>1424245.0</td>
      <td>325.0</td>
      <td>13800000.0</td>
      <td>4.229413e+06</td>
      <td>16500000.0</td>
      <td>6945512.0</td>
      <td>BENIGN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8.0.6.4-8.6.0.1-0-0-0</td>
      <td>8.6.0.1</td>
      <td>0</td>
      <td>8.0.6.4</td>
      <td>0</td>
      <td>0</td>
      <td>6/7/2017 8:59</td>
      <td>119945515</td>
      <td>150</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>6909777.333</td>
      <td>1.170000e+07</td>
      <td>20400000.0</td>
      <td>6.0</td>
      <td>24400000.0</td>
      <td>2.430000e+07</td>
      <td>60100000.0</td>
      <td>5702188.0</td>
      <td>BENIGN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>192.168.10.14-65.55.44.109-59135-443-6</td>
      <td>192.168.10.14</td>
      <td>59135</td>
      <td>65.55.44.109</td>
      <td>443</td>
      <td>6</td>
      <td>6/7/2017 8:59</td>
      <td>60261928</td>
      <td>9</td>
      <td>7</td>
      <td>...</td>
      <td>20</td>
      <td>0.000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>BENIGN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>192.168.10.3-192.168.10.14-53-59555-17</td>
      <td>192.168.10.14</td>
      <td>59555</td>
      <td>192.168.10.3</td>
      <td>53</td>
      <td>17</td>
      <td>6/7/2017 8:59</td>
      <td>269</td>
      <td>2</td>
      <td>2</td>
      <td>...</td>
      <td>32</td>
      <td>0.000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>BENIGN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>170361</th>
      <td>157.240.18.35-192.168.10.51-443-55641-6</td>
      <td>157.240.18.35</td>
      <td>443</td>
      <td>192.168.10.51</td>
      <td>55641</td>
      <td>6</td>
      <td>6/7/2017 12:59</td>
      <td>49</td>
      <td>1</td>
      <td>3</td>
      <td>...</td>
      <td>20</td>
      <td>0.000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>BENIGN</td>
    </tr>
    <tr>
      <th>170362</th>
      <td>192.168.10.51-199.16.156.120-45337-443-6</td>
      <td>199.16.156.120</td>
      <td>443</td>
      <td>192.168.10.51</td>
      <td>45337</td>
      <td>6</td>
      <td>6/7/2017 12:59</td>
      <td>217</td>
      <td>2</td>
      <td>1</td>
      <td>...</td>
      <td>32</td>
      <td>0.000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>BENIGN</td>
    </tr>
    <tr>
      <th>170363</th>
      <td>192.168.10.12-192.168.10.50-60148-22-6</td>
      <td>192.168.10.12</td>
      <td>60148</td>
      <td>192.168.10.50</td>
      <td>22</td>
      <td>6</td>
      <td>6/7/2017 12:59</td>
      <td>1387547</td>
      <td>41</td>
      <td>46</td>
      <td>...</td>
      <td>32</td>
      <td>0.000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>BENIGN</td>
    </tr>
    <tr>
      <th>170364</th>
      <td>192.168.10.12-192.168.10.50-60146-22-6</td>
      <td>192.168.10.12</td>
      <td>60146</td>
      <td>192.168.10.50</td>
      <td>22</td>
      <td>6</td>
      <td>6/7/2017 12:59</td>
      <td>207</td>
      <td>1</td>
      <td>1</td>
      <td>...</td>
      <td>32</td>
      <td>0.000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>BENIGN</td>
    </tr>
    <tr>
      <th>170365</th>
      <td>192.168.10.12-192.168.10.50-60146-22-6</td>
      <td>192.168.10.50</td>
      <td>22</td>
      <td>192.168.10.12</td>
      <td>60146</td>
      <td>6</td>
      <td>6/7/2017 12:59</td>
      <td>50</td>
      <td>1</td>
      <td>2</td>
      <td>...</td>
      <td>32</td>
      <td>0.000</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000e+00</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>BENIGN</td>
    </tr>
  </tbody>
</table>
<p>170366 rows × 85 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(170366, 85)
</pre></div>
</div>
</div>
</div>
<p>The columns “Fwd Header Length” and “Fwd Header Length.1” are identical, the second one is removed, 84 columns remain.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Fwd Header Length.1&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(170366, 84)
</pre></div>
</div>
</div>
</div>
<p>When assessing the distribution of labels, it turns out that out of 458968 records there are many blank records (“BENIGN” - benign background traffic).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([&#39;BENIGN&#39;, &#39;Web Attack – Brute Force&#39;, &#39;Web Attack – XSS&#39;,
       &#39;Web Attack – Sql Injection&#39;], dtype=object)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label
BENIGN                        168186
Web Attack – Brute Force        1507
Web Attack – XSS                 652
Web Attack – Sql Injection        21
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Delete blank records.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">isnull</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Flow ID&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(170366, 84)
</pre></div>
</div>
</div>
</div>
<p>The “Flow Bytes/s” and “Flow Packets/s” columns have non-numerical values, replace them.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Infinity&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Flow Bytes/s&quot;</span><span class="p">,</span> <span class="s2">&quot;Flow Packets/s&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;Flow Bytes/s&quot;</span><span class="p">,</span> <span class="s2">&quot;Flow Packets/s&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Replace the NaN values and infinity values with -1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Convert string characters to numbers, use LabelEncoder, not OneHotEncoder.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">string_features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
<span class="n">string_features</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">)</span>
<span class="n">string_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Flow ID&#39;, &#39;Source IP&#39;, &#39;Destination IP&#39;, &#39;Timestamp&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">le</span> <span class="o">=</span> <span class="n">preprocessing</span><span class="o">.</span><span class="n">LabelEncoder</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="n">string_features</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">string_features</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">col</span><span class="p">:</span> <span class="n">le</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">col</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<section id="undersampling-against-unbalance">
<h3>Undersampling against unbalance<a class="headerlink" href="#undersampling-against-unbalance" title="Link to this heading">#</a></h3>
<p>Dataset is unbalanced: total records = 170366, “BENIGN” records = 168186, records with attacks much less: 1507 + 652 + 21 = 2180.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">benign_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;BENIGN&quot;</span><span class="p">])</span>
<span class="n">benign_total</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>168186
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">attack_total</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;BENIGN&quot;</span><span class="p">])</span>
<span class="n">attack_total</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2180
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;web_attacks_unbalanced.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label
BENIGN                        168186
Web Attack – Brute Force        1507
Web Attack – XSS                 652
Web Attack – Sql Injection        21
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>We use <strong>undersampling</strong> to correct class imbalances: we remove most of the “BENIGN” records.</p>
<p>Form a balanced dataset web_attacks_balanced.csv in proportion: 30% attack (2180 records), 70% benign data (2180 / 30 * 70 ~ = 5087 records).</p>
<p>Algorithm to form a balanced df_balanced dataset:</p>
<ul class="simple">
<li><p>All the records with the attacks are copied to the new dataset.</p></li>
<li><p>There are two conditions for copying “BENIGN” records to the new dataset:</p>
<ol class="arabic simple">
<li><p>The next record is copyied with the benign_inc_probability.</p></li>
<li><p>The total number of “BENIGN” records must not exceed the limit of 5087 records.</p></li>
</ol>
</li>
</ul>
<p>Сalculate the probability of copying a “BENIGN” record. The enlargement multiplier is used to get exactly 70% benign data (5087 records).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">enlargement</span> <span class="o">=</span> <span class="mf">1.1</span>
<span class="n">benign_included_max</span> <span class="o">=</span> <span class="n">attack_total</span> <span class="o">/</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">70</span>
<span class="n">benign_inc_probability</span> <span class="o">=</span> <span class="p">(</span><span class="n">benign_included_max</span> <span class="o">/</span> <span class="n">benign_total</span><span class="p">)</span> <span class="o">*</span> <span class="n">enlargement</span>
<span class="nb">print</span><span class="p">(</span><span class="n">benign_included_max</span><span class="p">,</span> <span class="n">benign_inc_probability</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5086.666666666667 0.03326872232726466
</pre></div>
</div>
</div>
</div>
<p>Copy records from df to df_balanced, save dataset <strong>web_attacks_balanced.csv</strong>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">random</span>

<span class="n">indexes</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">benign_included_count</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;BENIGN&quot;</span><span class="p">:</span>
        <span class="n">indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Copying with benign_inc_probability</span>
        <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">benign_inc_probability</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1"># Have we achieved 70% (5087 records)?</span>
        <span class="k">if</span> <span class="n">benign_included_count</span> <span class="o">&gt;</span> <span class="n">benign_included_max</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">benign_included_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">indexes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
<span class="n">df_balanced</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">indexes</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_balanced</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Label
BENIGN                        5087
Web Attack – Brute Force      1507
Web Attack – XSS               652
Web Attack – Sql Injection      21
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
</section>
<section id="preparing-data-for-training">
<h3>Preparing data for training<a class="headerlink" href="#preparing-data-for-training" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df_balanced</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>The Label column is encoded as follows: “BENIGN” = 0, attack = 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;BENIGN&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>7 features (Flow ID, Source IP, Source Port, Destination IP, Destination Port, Protocol, Timestamp) are excluded from the dataset. The hypothesis is that the “shape” of the data being transmitted is more important than these attributes. In addition, ports and addresses can be substituted by an attacker, so it is better that the ML algorithm does not take these features into account in training [Kostas2018].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">excluded</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Flow ID&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Source IP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Source Port&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Destination IP&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Destination Port&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Protocol&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Timestamp&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">excluded</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Below at the stage of importance estimation the “Init_Win_bytes_backward” feature has the maximum value. After viewing the source dataset, it seems that an inaccuracy was made in forming the dataset.</p>
<p>It turns out that it is possible to make a fairly accurate classification by one feature.</p>
<p>Description of features: <a class="reference external" href="http://www.netflowmeter.ca/netflowmeter.html">http://www.netflowmeter.ca/netflowmeter.html</a></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span> Init_Win_bytes_backward - The total number of bytes sent in initial window in the backward direction
 Init_Win_bytes_forward - The total number of bytes sent in initial window in the forward direction
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s2">&quot;Init_Win_bytes_backward&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Init_Win_bytes_backward&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Init_Win_bytes_backward&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Value bins&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;Init_Win_bytes_backward.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/48f910f7e01b193879520b3b3beb88d469b4c29cca36930460fcde49bd679bd1.png" src="../_images/48f910f7e01b193879520b3b3beb88d469b4c29cca36930460fcde49bd679bd1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="s2">&quot;Init_Win_bytes_forward&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Init_Win_bytes_forward&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Init_Win_bytes_forward&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Value bins&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;Init_Win_bytes_forward.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d40d562043b3c68394da80fb712edce2ee32b0e9c038646176618f9605eb925b.png" src="../_images/d40d562043b3c68394da80fb712edce2ee32b0e9c038646176618f9605eb925b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">excluded2</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Init_Win_bytes_backward&quot;</span><span class="p">,</span> <span class="s2">&quot;Init_Win_bytes_forward&quot;</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">excluded2</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(7267, 74) (7267,)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="feature-importance">
<h2>Feature importance<a class="headerlink" href="#feature-importance" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>

<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>

<span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">counts</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0: 3571, 1: 1515}
</pre></div>
</div>
</div>
</div>
<section id="visualization-of-the-decision-tree-importance-evaluation-using-a-single-tree-decisiontreeclassifier">
<h3>Visualization of the decision tree, importance evaluation using a single tree (DecisionTreeClassifier)<a class="headerlink" href="#visualization-of-the-decision-tree-importance-evaluation-using-a-single-tree-decisiontreeclassifier" title="Link to this heading">#</a></h3>
<p>In the beginning we use one tree - for the convenience of visualization of the classifier. High cross-validation scores even with 5 leaves look suspiciously good, we should look at the data carefully. Parameters for change - test_size in the cell above (train_test_split), max_leaf_nodes in the cell below.</p>
<p>By changing the <strong>random_state</strong> parameter, we will get different trees and different features with the highest importance. But the forest will already average individual trees below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">cross_val_score</span>
<span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">DecisionTreeClassifier</span>

<span class="n">decision_tree</span> <span class="o">=</span> <span class="n">DecisionTreeClassifier</span><span class="p">(</span><span class="n">max_leaf_nodes</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">decision_tree</span> <span class="o">=</span> <span class="n">decision_tree</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">cross_val_score</span><span class="p">(</span><span class="n">decision_tree</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.96463654, 0.95284872, 0.95874263, 0.97249509, 0.95284872,
       0.94695481, 0.94685039, 0.97244094, 0.96259843, 0.96259843])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="n">export_text</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">export_text</span><span class="p">(</span><span class="n">decision_tree</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>|--- Max Packet Length &lt;= 3.00
|   |--- Fwd IAT Std &lt;= 2454249.88
|   |   |--- Bwd Packets/s &lt;= 10256.68
|   |   |   |--- class: 0
|   |   |--- Bwd Packets/s &gt;  10256.68
|   |   |   |--- class: 0
|   |--- Fwd IAT Std &gt;  2454249.88
|   |   |--- class: 1
|--- Max Packet Length &gt;  3.00
|   |--- Total Length of Fwd Packets &lt;= 32821.50
|   |   |--- class: 0
|   |--- Total Length of Fwd Packets &gt;  32821.50
|   |   |--- class: 1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">graphviz</span> <span class="kn">import</span> <span class="n">Source</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">tree</span>

<span class="n">Source</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">export_graphviz</span><span class="p">(</span><span class="n">decision_tree</span><span class="p">,</span> <span class="n">out_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_names</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/backend/execute.py:79,</span> in <span class="ni">run_check</span><span class="nt">(cmd, input_lines, encoding, quiet, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">78</span>         <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;stdout&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;stderr&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
<span class="ne">---&gt; </span><span class="mi">79</span>     <span class="n">proc</span> <span class="o">=</span> <span class="n">_run_input_lines</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">input_lines</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">80</span> <span class="k">else</span><span class="p">:</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/backend/execute.py:99,</span> in <span class="ni">_run_input_lines</span><span class="nt">(cmd, input_lines, kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">98</span> <span class="k">def</span> <span class="nf">_run_input_lines</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">input_lines</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">99</span>     <span class="n">popen</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">101</span>     <span class="n">stdin_write</span> <span class="o">=</span> <span class="n">popen</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/subprocess.py:951,</span> in <span class="ni">Popen.__init__</span><span class="nt">(self, args, bufsize, executable, stdin, stdout, stderr, preexec_fn, close_fds, shell, cwd, env, universal_newlines, startupinfo, creationflags, restore_signals, start_new_session, pass_fds, user, group, extra_groups, encoding, errors, text, umask)</span>
<span class="g g-Whitespace">    </span><span class="mi">948</span>             <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">TextIOWrapper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">949</span>                     <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="n">errors</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">951</span>     <span class="bp">self</span><span class="o">.</span><span class="n">_execute_child</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">executable</span><span class="p">,</span> <span class="n">preexec_fn</span><span class="p">,</span> <span class="n">close_fds</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">952</span>                         <span class="n">pass_fds</span><span class="p">,</span> <span class="n">cwd</span><span class="p">,</span> <span class="n">env</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">953</span>                         <span class="n">startupinfo</span><span class="p">,</span> <span class="n">creationflags</span><span class="p">,</span> <span class="n">shell</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">954</span>                         <span class="n">p2cread</span><span class="p">,</span> <span class="n">p2cwrite</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">955</span>                         <span class="n">c2pread</span><span class="p">,</span> <span class="n">c2pwrite</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">956</span>                         <span class="n">errread</span><span class="p">,</span> <span class="n">errwrite</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">957</span>                         <span class="n">restore_signals</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">958</span>                         <span class="n">gid</span><span class="p">,</span> <span class="n">gids</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">umask</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">959</span>                         <span class="n">start_new_session</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">960</span> <span class="k">except</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">961</span>     <span class="c1"># Cleanup if the child failed starting.</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/subprocess.py:1837,</span> in <span class="ni">Popen._execute_child</span><span class="nt">(self, args, executable, preexec_fn, close_fds, pass_fds, cwd, env, startupinfo, creationflags, shell, p2cread, p2cwrite, c2pread, c2pwrite, errread, errwrite, restore_signals, gid, gids, uid, umask, start_new_session)</span>
<span class="g g-Whitespace">   </span><span class="mi">1836</span>         <span class="n">err_msg</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">strerror</span><span class="p">(</span><span class="n">errno_num</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1837</span>     <span class="k">raise</span> <span class="n">child_exception_type</span><span class="p">(</span><span class="n">errno_num</span><span class="p">,</span> <span class="n">err_msg</span><span class="p">,</span> <span class="n">err_filename</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1838</span> <span class="k">raise</span> <span class="n">child_exception_type</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: PosixPath(&#39;dot&#39;)

<span class="n">The</span> <span class="n">above</span> <span class="n">exception</span> <span class="n">was</span> <span class="n">the</span> <span class="n">direct</span> <span class="n">cause</span> <span class="n">of</span> <span class="n">the</span> <span class="n">following</span> <span class="n">exception</span><span class="p">:</span>

<span class="ne">ExecutableNotFound</span><span class="g g-Whitespace">                        </span>Traceback (most recent call last)
<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/IPython/core/formatters.py:974,</span> in <span class="ni">MimeBundleFormatter.__call__</span><span class="nt">(self, obj, include, exclude)</span>
<span class="g g-Whitespace">    </span><span class="mi">971</span>     <span class="n">method</span> <span class="o">=</span> <span class="n">get_real_method</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">print_method</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">973</span>     <span class="k">if</span> <span class="n">method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">974</span>         <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="n">include</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">975</span>     <span class="k">return</span> <span class="kc">None</span>
<span class="g g-Whitespace">    </span><span class="mi">976</span> <span class="k">else</span><span class="p">:</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/jupyter_integration.py:98,</span> in <span class="ni">JupyterIntegration._repr_mimebundle_</span><span class="nt">(self, include, exclude, **_)</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span> <span class="n">include</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">include</span><span class="p">)</span> <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_jupyter_mimetype</span><span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span> <span class="n">include</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude</span> <span class="ow">or</span> <span class="p">[])</span>
<span class="ne">---&gt; </span><span class="mi">98</span> <span class="k">return</span> <span class="p">{</span><span class="n">mimetype</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)()</span>
<span class="nn">     99         for mimetype, method_name</span> in <span class="ni">MIME_TYPES.items</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span>         <span class="k">if</span> <span class="n">mimetype</span> <span class="ow">in</span> <span class="n">include</span><span class="p">}</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/jupyter_integration.py:98,</span> in <span class="ni">&lt;dictcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">     </span><span class="mi">96</span> <span class="n">include</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">include</span><span class="p">)</span> <span class="k">if</span> <span class="n">include</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_jupyter_mimetype</span><span class="p">}</span>
<span class="g g-Whitespace">     </span><span class="mi">97</span> <span class="n">include</span> <span class="o">-=</span> <span class="nb">set</span><span class="p">(</span><span class="n">exclude</span> <span class="ow">or</span> <span class="p">[])</span>
<span class="ne">---&gt; </span><span class="mi">98</span> <span class="k">return</span> <span class="p">{</span><span class="n">mimetype</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)()</span>
<span class="nn">     99         for mimetype, method_name</span> in <span class="ni">MIME_TYPES.items</span><span class="nt">()</span>
<span class="g g-Whitespace">    </span><span class="mi">100</span>         <span class="k">if</span> <span class="n">mimetype</span> <span class="ow">in</span> <span class="n">include</span><span class="p">}</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/jupyter_integration.py:112,</span> in <span class="ni">JupyterIntegration._repr_image_svg_xml</span><span class="nt">(self)</span>
<span class="g g-Whitespace">    </span><span class="mi">110</span> <span class="k">def</span> <span class="nf">_repr_image_svg_xml</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">111</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Return the rendered graph as SVG string.&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">112</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">pipe</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s1">&#39;svg&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">SVG_ENCODING</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/piping.py:104,</span> in <span class="ni">Pipe.pipe</span><span class="nt">(self, format, renderer, formatter, neato_no_op, quiet, engine, encoding)</span>
<span class="g g-Whitespace">     </span><span class="mi">55</span> <span class="k">def</span> <span class="nf">pipe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span>          <span class="nb">format</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>          <span class="n">renderer</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">61</span>          <span class="n">engine</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span>          <span class="n">encoding</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="g g-Whitespace">     </span><span class="mi">63</span><span class="w">     </span><span class="sd">&quot;&quot;&quot;Return the source piped through the Graphviz layout command.</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span><span class="sd"> </span>
<span class="g g-Whitespace">     </span><span class="mi">65</span><span class="sd">     Args:</span>
<span class="sd">   (...)</span>
<span class="g g-Whitespace">    </span><span class="mi">102</span><span class="sd">         &#39;&lt;?xml version=&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">103</span><span class="sd">     &quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">104</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe_legacy</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">105</span>                              <span class="n">renderer</span><span class="o">=</span><span class="n">renderer</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">106</span>                              <span class="n">formatter</span><span class="o">=</span><span class="n">formatter</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">107</span>                              <span class="n">neato_no_op</span><span class="o">=</span><span class="n">neato_no_op</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">108</span>                              <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">109</span>                              <span class="n">engine</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">110</span>                              <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/_tools.py:171,</span> in <span class="ni">deprecate_positional_args.&lt;locals&gt;.decorator.&lt;locals&gt;.wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">162</span>     <span class="n">wanted</span> <span class="o">=</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">=</span><span class="si">{</span><span class="n">value</span><span class="si">!r}</span><span class="s1">&#39;</span>
<span class="nn">    163                        for name, value</span> in <span class="ni">deprecated.items</span><span class="nt">())</span>
<span class="g g-Whitespace">    </span><span class="mi">164</span>     <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The signature of </span><span class="si">{</span><span class="n">func</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s1"> will be reduced&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">165</span>                   <span class="sa">f</span><span class="s1">&#39; to </span><span class="si">{</span><span class="n">supported_number</span><span class="si">}</span><span class="s1"> positional args&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">166</span>                   <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">supported</span><span class="p">)</span><span class="si">}</span><span class="s1">: pass </span><span class="si">{</span><span class="n">wanted</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="g g-Whitespace">    </span><span class="mi">167</span>                   <span class="s1">&#39; as keyword arg(s)&#39;</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">168</span>                   <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span>                   <span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">171</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/piping.py:121,</span> in <span class="ni">Pipe._pipe_legacy</span><span class="nt">(self, format, renderer, formatter, neato_no_op, quiet, engine, encoding)</span>
<span class="g g-Whitespace">    </span><span class="mi">112</span> <span class="nd">@_tools</span><span class="o">.</span><span class="n">deprecate_positional_args</span><span class="p">(</span><span class="n">supported_number</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">113</span> <span class="k">def</span> <span class="nf">_pipe_legacy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">114</span>                  <span class="nb">format</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">119</span>                  <span class="n">engine</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">120</span>                  <span class="n">encoding</span><span class="p">:</span> <span class="n">typing</span><span class="o">.</span><span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="ne">--&gt; </span><span class="mi">121</span>     <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe_future</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">122</span>                              <span class="n">renderer</span><span class="o">=</span><span class="n">renderer</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">123</span>                              <span class="n">formatter</span><span class="o">=</span><span class="n">formatter</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">124</span>                              <span class="n">neato_no_op</span><span class="o">=</span><span class="n">neato_no_op</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">125</span>                              <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">126</span>                              <span class="n">engine</span><span class="o">=</span><span class="n">engine</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">127</span>                              <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/piping.py:149,</span> in <span class="ni">Pipe._pipe_future</span><span class="nt">(self, format, renderer, formatter, neato_no_op, quiet, engine, encoding)</span>
<span class="g g-Whitespace">    </span><span class="mi">146</span> <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">147</span>     <span class="k">if</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="n">encoding</span><span class="p">)</span> <span class="ow">is</span> <span class="n">codecs</span><span class="o">.</span><span class="n">lookup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">148</span>         <span class="c1"># common case: both stdin and stdout need the same encoding</span>
<span class="ne">--&gt; </span><span class="mi">149</span>         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe_lines_string</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">150</span>     <span class="k">try</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">151</span>         <span class="n">raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_pipe_lines</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">input_encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">encoding</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/backend/piping.py:212,</span> in <span class="ni">pipe_lines_string</span><span class="nt">(engine, format, input_lines, encoding, renderer, formatter, neato_no_op, quiet)</span>
<span class="g g-Whitespace">    </span><span class="mi">206</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">dot_command</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">engine</span><span class="p">,</span> <span class="nb">format</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">207</span>                           <span class="n">renderer</span><span class="o">=</span><span class="n">renderer</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">208</span>                           <span class="n">formatter</span><span class="o">=</span><span class="n">formatter</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">209</span>                           <span class="n">neato_no_op</span><span class="o">=</span><span class="n">neato_no_op</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">210</span> <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;input_lines&#39;</span><span class="p">:</span> <span class="n">input_lines</span><span class="p">,</span> <span class="s1">&#39;encoding&#39;</span><span class="p">:</span> <span class="n">encoding</span><span class="p">}</span>
<span class="ne">--&gt; </span><span class="mi">212</span> <span class="n">proc</span> <span class="o">=</span> <span class="n">execute</span><span class="o">.</span><span class="n">run_check</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="n">quiet</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">213</span> <span class="k">return</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span>

<span class="nn">File ~/micromamba/envs/wsu/lib/python3.9/site-packages/graphviz/backend/execute.py:84,</span> in <span class="ni">run_check</span><span class="nt">(cmd, input_lines, encoding, quiet, **kwargs)</span>
<span class="g g-Whitespace">     </span><span class="mi">82</span> <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">83</span>     <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">errno</span> <span class="o">==</span> <span class="n">errno</span><span class="o">.</span><span class="n">ENOENT</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">84</span>         <span class="k">raise</span> <span class="n">ExecutableNotFound</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="kn">from</span> <span class="nn">e</span>
<span class="g g-Whitespace">     </span><span class="mi">85</span>     <span class="k">raise</span>
<span class="g g-Whitespace">     </span><span class="mi">87</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">quiet</span> <span class="ow">and</span> <span class="n">proc</span><span class="o">.</span><span class="n">stderr</span><span class="p">:</span>

<span class="ne">ExecutableNotFound</span>: failed to execute PosixPath(&#39;dot&#39;), make sure the Graphviz executables are on your systems&#39; PATH
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;graphviz.sources.Source at 0x7f28caed4d30&gt;
</pre></div>
</div>
</div>
</div>
<p>Analyze the confusion matrix. Which classes are confidently classified by the model?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">counts</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0: 1516, 1: 665}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span>

<span class="n">y_pred</span> <span class="o">=</span> <span class="n">decision_tree</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1505,   11],
       [  97,  568]])
</pre></div>
</div>
</div>
</div>
</section>
<section id="importance-evaluation-using-selectfrommodel">
<h3>Importance evaluation using SelectFromModel<a class="headerlink" href="#importance-evaluation-using-selectfrommodel" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">SelectFromModel</span>

<span class="n">sfm</span> <span class="o">=</span> <span class="n">SelectFromModel</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">decision_tree</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="n">sfm</span><span class="o">.</span><span class="n">estimator_</span><span class="o">.</span><span class="n">feature_importances_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.        , 0.        , 0.        , 0.06230676, 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.1981437 , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.01768306, 0.        , 0.72186648, 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        , 0.        ,
       0.        , 0.        , 0.        , 0.        ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sfm</span><span class="o">.</span><span class="n">threshold_</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.013513513513513514
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train_new</span> <span class="o">=</span> <span class="n">sfm</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;Original num features: </span><span class="si">{}</span><span class="s2">, selected num features: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_train_new</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Original num features: 74, selected num features: 4
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">decision_tree</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">[:</span><span class="mi">10</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.</span><span class="se">\t</span><span class="si">{}</span><span class="s2"> - </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">idx</span><span class="p">,</span> <span class="n">X_train</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">decision_tree</span><span class="o">.</span><span class="n">feature_importances_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.	Max Packet Length - 0.7218664752320741
1.	Fwd IAT Std - 0.19814370190487834
2.	Total Length of Fwd Packets - 0.06230675880412216
3.	Bwd Packets/s - 0.017683064058925304
4.	Bwd IAT Std - 0.0
5.	Fwd IAT Mean - 0.0
6.	Fwd IAT Max - 0.0
7.	Fwd IAT Min - 0.0
8.	Bwd IAT Total - 0.0
9.	Bwd IAT Mean - 0.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="evaluation-of-importance-using-randomforestclassifier-feature-importances">
<h3>Evaluation of importance using RandomForestClassifier.feature_importances_<a class="headerlink" href="#evaluation-of-importance-using-randomforestclassifier-feature-importances" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>

<span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="c1"># Score = mean accuracy on the given test data and labels</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="s2">&quot;R^2 Training Score: </span><span class="si">{:.2f}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">R^2 Validation Score: </span><span class="si">{:.2f}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">Out-of-bag Score: </span><span class="si">{:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
        <span class="n">rf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">),</span> <span class="n">rf</span><span class="o">.</span><span class="n">score</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">),</span> <span class="n">rf</span><span class="o">.</span><span class="n">oob_score_</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>R^2 Training Score: 0.99 
R^2 Validation Score: 0.97 
Out-of-bag Score: 0.98
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>
<span class="n">importances</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">webattack_features</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">[:</span><span class="mi">20</span><span class="p">]):</span>
    <span class="n">webattack_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.</span><span class="se">\t</span><span class="s2">#</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:.3f}</span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">importances</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.	#51	0.085	Average Packet Size
2.	#13	0.069	Flow Bytes/s
3.	#38	0.062	Max Packet Length
4.	#39	0.062	Packet Length Mean
5.	#61	0.059	Subflow Fwd Bytes
6.	#23	0.057	Fwd IAT Min
7.	#7	0.057	Fwd Packet Length Mean
8.	#3	0.045	Total Length of Fwd Packets
9.	#52	0.045	Avg Fwd Segment Size
10.	#21	0.035	Fwd IAT Std
11.	#15	0.033	Flow IAT Mean
12.	#5	0.031	Fwd Packet Length Max
13.	#33	0.024	Fwd Header Length
14.	#0	0.021	Flow Duration
15.	#14	0.021	Flow Packets/s
16.	#16	0.020	Flow IAT Std
17.	#35	0.018	Fwd Packets/s
18.	#19	0.018	Fwd IAT Total
19.	#20	0.017	Fwd IAT Mean
20.	#22	0.016	Fwd IAT Max
</pre></div>
</div>
</div>
</div>
<p>For comparison, the results of the study [Sharafaldin2018] (compare relatively, without taking into account the multiplier):</p>
<ul class="simple">
<li><p>Init Win F.Bytes 0.0200</p></li>
<li><p>Subflow F.Bytes 0.0145</p></li>
<li><p>Init Win B.Bytes 0.0129</p></li>
<li><p>Total Len F.Packets 0.0096</p></li>
</ul>
<p>And incorrect results [Kostas2018] (error was found in assessing the importance of features, line: <em>impor_bars = pd.DataFrame({‘Features’:refclasscol[0:20],’importance’:importances[0:20]})</em>, the importances[0:20] sample does not take into account that the values are not sorted in descending order):</p>
<ul class="simple">
<li><p>Flow Bytes/s 0.313402</p></li>
<li><p>Total Length of Fwd Packets 0.304917</p></li>
<li><p>Flow Duration 0.000485</p></li>
<li><p>Fwd Packet Length Max 0.00013</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)[</span><span class="o">-</span><span class="mi">20</span><span class="p">:]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Feature Importances&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="n">importances</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#cccccc&quot;</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)),</span> <span class="p">[</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Relative Importance&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;feature_importances.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8d1e2793ba86f90b8760a5d11b64b0d2399967a5425dbe504d15b08803da70ef.png" src="../_images/8d1e2793ba86f90b8760a5d11b64b0d2399967a5425dbe504d15b08803da70ef.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1495,   21],
       [  34,  631]])
</pre></div>
</div>
</div>
</div>
<p>Next, for experiments, we keep the first max_features of features with maximum importance.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_features</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">webattack_features</span> <span class="o">=</span> <span class="n">webattack_features</span><span class="p">[:</span><span class="n">max_features</span><span class="p">]</span>
<span class="n">webattack_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Average Packet Size&#39;,
 &#39;Flow Bytes/s&#39;,
 &#39;Max Packet Length&#39;,
 &#39;Packet Length Mean&#39;,
 &#39;Subflow Fwd Bytes&#39;,
 &#39;Fwd IAT Min&#39;,
 &#39;Fwd Packet Length Mean&#39;,
 &#39;Total Length of Fwd Packets&#39;,
 &#39;Avg Fwd Segment Size&#39;,
 &#39;Fwd IAT Std&#39;,
 &#39;Flow IAT Mean&#39;,
 &#39;Fwd Packet Length Max&#39;,
 &#39;Fwd Header Length&#39;,
 &#39;Flow Duration&#39;,
 &#39;Flow Packets/s&#39;,
 &#39;Flow IAT Std&#39;,
 &#39;Fwd Packets/s&#39;,
 &#39;Fwd IAT Total&#39;,
 &#39;Fwd IAT Mean&#39;,
 &#39;Fwd IAT Max&#39;]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="analysis-of-selected-features">
<h2>Analysis of selected features<a class="headerlink" href="#analysis-of-selected-features" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">webattack_features</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;features_hist.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/63dd0282ff6ce14497730152b7cb0c44b108291f061f46053e93e292f0a61633.png" src="../_images/63dd0282ff6ce14497730152b7cb0c44b108291f061f46053e93e292f0a61633.png" />
</div>
</div>
<p>Install Facets Overview</p>
<p><a class="reference external" href="https://pair-code.github.io/facets/">https://pair-code.github.io/facets/</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>facets-overview
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: facets-overview in /home/soraxas/micromamba/envs/wsu/lib/python3.9/site-packages (1.1.1)
Requirement already satisfied: numpy&gt;=1.16.0 in /home/soraxas/micromamba/envs/wsu/lib/python3.9/site-packages (from facets-overview) (1.26.3)
Requirement already satisfied: pandas&gt;=0.22.0 in /home/soraxas/micromamba/envs/wsu/lib/python3.9/site-packages (from facets-overview) (2.2.0)
Requirement already satisfied: protobuf&gt;=3.20.0 in /home/soraxas/micromamba/envs/wsu/lib/python3.9/site-packages (from facets-overview) (4.23.4)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /home/soraxas/micromamba/envs/wsu/lib/python3.9/site-packages (from pandas&gt;=0.22.0-&gt;facets-overview) (2.8.2)
Requirement already satisfied: pytz&gt;=2020.1 in /home/soraxas/micromamba/envs/wsu/lib/python3.9/site-packages (from pandas&gt;=0.22.0-&gt;facets-overview) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in /home/soraxas/micromamba/envs/wsu/lib/python3.9/site-packages (from pandas&gt;=0.22.0-&gt;facets-overview) (2023.4)
Requirement already satisfied: six&gt;=1.5 in /home/soraxas/micromamba/envs/wsu/lib/python3.9/site-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&gt;=0.22.0-&gt;facets-overview) (1.16.0)
</pre></div>
</div>
</div>
</div>
<p>Create the feature stats for the datasets and stringify it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">facets_overview.generic_feature_statistics_generator</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">GenericFeatureStatisticsGenerator</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">gfsg</span> <span class="o">=</span> <span class="n">GenericFeatureStatisticsGenerator</span><span class="p">()</span>
<span class="n">proto</span> <span class="o">=</span> <span class="n">gfsg</span><span class="o">.</span><span class="n">ProtoFromDataFrames</span><span class="p">(</span>
    <span class="p">[{</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;train + test&quot;</span><span class="p">,</span> <span class="s2">&quot;table&quot;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="n">webattack_features</span><span class="p">]}]</span>
<span class="p">)</span>
<span class="n">protostr</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">proto</span><span class="o">.</span><span class="n">SerializeToString</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/home/soraxas/micromamba/envs/wsu/lib/python3.9/site-packages/facets_overview/base_generic_feature_statistics_generator.py:121: FutureWarning: Series.ravel is deprecated. The underlying array is already 1D, so ravel is not necessary.  Use `to_numpy()` for conversion to a numpy array instead.
  flattened = x.ravel()
</pre></div>
</div>
</div>
</div>
<p>Display the facets overview visualization for this data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>

<span class="n">HTML_TEMPLATE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.3.3/webcomponents-lite.js&quot;&gt;&lt;/script&gt;</span>
<span class="s2">        &lt;link rel=&quot;import&quot; href=&quot;https://raw.githubusercontent.com/PAIR-code/facets/1.0.0/facets-dist/facets-jupyter.html&quot; &gt;</span>
<span class="s2">        &lt;facets-overview id=&quot;elem&quot;&gt;&lt;/facets-overview&gt;</span>
<span class="s2">        &lt;script&gt;</span>
<span class="s2">          document.querySelector(&quot;#elem&quot;).protoInput = &quot;</span><span class="si">{protostr}</span><span class="s2">&quot;;</span>
<span class="s2">        &lt;/script&gt;&quot;&quot;&quot;</span>
<span class="n">html</span> <span class="o">=</span> <span class="n">HTML_TEMPLATE</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">protostr</span><span class="o">=</span><span class="n">protostr</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/webcomponentsjs/1.3.3/webcomponents-lite.js"></script>
        <link rel="import" href="https://raw.githubusercontent.com/PAIR-code/facets/1.0.0/facets-dist/facets-jupyter.html" >
        <facets-overview id="elem"></facets-overview>
        <script>
          document.querySelector("#elem").protoInput = "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";
        </script></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">webattack_features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.1g&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">)</span>
<span class="n">g</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span>
    <span class="n">g</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span>
    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
    <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;corr_heatmap.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/93025455eafb1da654946ef94830b5ce02c501f601d49a69170197e2979b3324.png" src="../_images/93025455eafb1da654946ef94830b5ce02c501f601d49a69170197e2979b3324.png" />
</div>
</div>
<p>Remove correlated features.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">to_be_removed</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;Packet Length Mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Avg Fwd Segment Size&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Subflow Fwd Bytes&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fwd Packets/s&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fwd IAT Total&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Fwd IAT Max&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">webattack_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">item</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">webattack_features</span> <span class="k">if</span> <span class="n">item</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">to_be_removed</span><span class="p">]</span>
<span class="n">webattack_features</span> <span class="o">=</span> <span class="n">webattack_features</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">webattack_features</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;Average Packet Size&#39;,
 &#39;Flow Bytes/s&#39;,
 &#39;Max Packet Length&#39;,
 &#39;Fwd IAT Min&#39;,
 &#39;Fwd Packet Length Mean&#39;,
 &#39;Total Length of Fwd Packets&#39;,
 &#39;Fwd IAT Std&#39;,
 &#39;Flow IAT Mean&#39;,
 &#39;Fwd Packet Length Max&#39;,
 &#39;Fwd Header Length&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">webattack_features</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.1g&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Greys&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/4ae7689364ae51e874da2c697ca57a014a102e935d63a5028ed87c75f530c7d3.png" src="../_images/4ae7689364ae51e874da2c697ca57a014a102e935d63a5028ed87c75f530c7d3.png" />
</div>
</div>
</section>
<section id="hyperparameter-selection">
<h2>Hyperparameter selection<a class="headerlink" href="#hyperparameter-selection" title="Link to this heading">#</a></h2>
<p>Reopen the dataset.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">GridSearchCV</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">df_balanced</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;BENIGN&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">webattack_features</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(7267, 10) (7267,)
</pre></div>
</div>
</div>
</div>
<p>We get the list of RandomForestClassifier parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">get_params</span><span class="p">()</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dict_keys([&#39;bootstrap&#39;, &#39;ccp_alpha&#39;, &#39;class_weight&#39;, &#39;criterion&#39;, &#39;max_depth&#39;, &#39;max_features&#39;, &#39;max_leaf_nodes&#39;, &#39;max_samples&#39;, &#39;min_impurity_decrease&#39;, &#39;min_samples_leaf&#39;, &#39;min_samples_split&#39;, &#39;min_weight_fraction_leaf&#39;, &#39;monotonic_cst&#39;, &#39;n_estimators&#39;, &#39;n_jobs&#39;, &#39;oob_score&#39;, &#39;random_state&#39;, &#39;verbose&#39;, &#39;warm_start&#39;])
</pre></div>
</div>
</div>
</div>
<p>For search of quasi-optimal value of one parameter we fix the others.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parameters</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;n_estimators&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="p">],</span>
    <span class="s2">&quot;min_samples_leaf&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="s2">&quot;max_features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="s2">&quot;max_depth&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">scoring</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="s2">&quot;accuracy&quot;</span><span class="p">)</span>
<span class="n">gcv</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">rfc</span><span class="p">,</span> <span class="n">parameters</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="n">scoring</span><span class="p">,</span> <span class="n">refit</span><span class="o">=</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">return_train_score</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
<span class="n">gcv</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">gcv</span><span class="o">.</span><span class="n">cv_results_</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cv_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">gcv</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">)</span>
<span class="n">cv_results</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>mean_fit_time</th>
      <th>std_fit_time</th>
      <th>mean_score_time</th>
      <th>std_score_time</th>
      <th>param_max_depth</th>
      <th>param_max_features</th>
      <th>param_min_samples_leaf</th>
      <th>param_n_estimators</th>
      <th>params</th>
      <th>split0_test_f1</th>
      <th>...</th>
      <th>split2_train_accuracy</th>
      <th>split3_train_accuracy</th>
      <th>split4_train_accuracy</th>
      <th>split5_train_accuracy</th>
      <th>split6_train_accuracy</th>
      <th>split7_train_accuracy</th>
      <th>split8_train_accuracy</th>
      <th>split9_train_accuracy</th>
      <th>mean_train_accuracy</th>
      <th>std_train_accuracy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.011794</td>
      <td>0.000374</td>
      <td>0.001573</td>
      <td>0.000136</td>
      <td>1</td>
      <td>3</td>
      <td>3</td>
      <td>10</td>
      <td>{'max_depth': 1, 'max_features': 3, 'min_sampl...</td>
      <td>0.891509</td>
      <td>...</td>
      <td>0.906575</td>
      <td>0.906881</td>
      <td>0.905505</td>
      <td>0.909786</td>
      <td>0.905199</td>
      <td>0.906131</td>
      <td>0.904908</td>
      <td>0.908730</td>
      <td>0.906564</td>
      <td>0.001923</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.015826</td>
      <td>0.000166</td>
      <td>0.001633</td>
      <td>0.000103</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>10</td>
      <td>{'max_depth': 2, 'max_features': 3, 'min_sampl...</td>
      <td>0.894472</td>
      <td>...</td>
      <td>0.959021</td>
      <td>0.958257</td>
      <td>0.958410</td>
      <td>0.958257</td>
      <td>0.959633</td>
      <td>0.955359</td>
      <td>0.954900</td>
      <td>0.959792</td>
      <td>0.958182</td>
      <td>0.001711</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.019654</td>
      <td>0.000284</td>
      <td>0.001686</td>
      <td>0.000130</td>
      <td>3</td>
      <td>3</td>
      <td>3</td>
      <td>10</td>
      <td>{'max_depth': 3, 'max_features': 3, 'min_sampl...</td>
      <td>0.891688</td>
      <td>...</td>
      <td>0.959174</td>
      <td>0.958410</td>
      <td>0.958716</td>
      <td>0.959174</td>
      <td>0.959480</td>
      <td>0.955053</td>
      <td>0.955206</td>
      <td>0.959945</td>
      <td>0.958396</td>
      <td>0.001723</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.022836</td>
      <td>0.000558</td>
      <td>0.001778</td>
      <td>0.000117</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>10</td>
      <td>{'max_depth': 4, 'max_features': 3, 'min_sampl...</td>
      <td>0.916256</td>
      <td>...</td>
      <td>0.972018</td>
      <td>0.967125</td>
      <td>0.966667</td>
      <td>0.962691</td>
      <td>0.969572</td>
      <td>0.968812</td>
      <td>0.969118</td>
      <td>0.972940</td>
      <td>0.969023</td>
      <td>0.002834</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.023506</td>
      <td>0.000631</td>
      <td>0.001776</td>
      <td>0.000067</td>
      <td>5</td>
      <td>3</td>
      <td>3</td>
      <td>10</td>
      <td>{'max_depth': 5, 'max_features': 3, 'min_sampl...</td>
      <td>0.937799</td>
      <td>...</td>
      <td>0.970031</td>
      <td>0.970031</td>
      <td>0.974312</td>
      <td>0.972477</td>
      <td>0.974312</td>
      <td>0.970188</td>
      <td>0.973857</td>
      <td>0.973399</td>
      <td>0.972616</td>
      <td>0.001729</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 59 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://scikit-learn.org/dev/auto_examples/model_selection/plot_multi_metric_evaluation.html</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;GridSearchCV results&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;max_depth&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;f1&quot;</span><span class="p">)</span>

<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">X_axis</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;param_max_depth&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

<span class="k">for</span> <span class="n">scorer</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">scoring</span><span class="p">),</span> <span class="p">[</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">]):</span>
    <span class="k">for</span> <span class="n">sample</span><span class="p">,</span> <span class="n">style</span> <span class="ow">in</span> <span class="p">((</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)):</span>
        <span class="n">sample_score_mean</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mean_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">scorer</span><span class="p">)]</span>
        <span class="n">sample_score_std</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;std_</span><span class="si">%s</span><span class="s2">_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">scorer</span><span class="p">)]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">X_axis</span><span class="p">,</span>
            <span class="n">sample_score_mean</span> <span class="o">-</span> <span class="n">sample_score_std</span><span class="p">,</span>
            <span class="n">sample_score_mean</span> <span class="o">+</span> <span class="n">sample_score_std</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span> <span class="k">if</span> <span class="n">sample</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">X_axis</span><span class="p">,</span>
            <span class="n">sample_score_mean</span><span class="p">,</span>
            <span class="n">style</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span> <span class="k">if</span> <span class="n">sample</span> <span class="o">==</span> <span class="s2">&quot;test&quot;</span> <span class="k">else</span> <span class="mf">0.7</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%s</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">scorer</span><span class="p">,</span> <span class="n">sample</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="n">best_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s2">&quot;rank_test_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">scorer</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">best_score</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;mean_test_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">scorer</span><span class="p">][</span><span class="n">best_index</span><span class="p">]</span>

    <span class="c1"># Plot a dotted vertical line at the best score for that scorer marked by x</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">X_axis</span><span class="p">[</span><span class="n">best_index</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">best_score</span><span class="p">],</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
        <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">ms</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Annotate the best score for that scorer</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%0.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">best_score</span><span class="p">,</span> <span class="p">(</span><span class="n">X_axis</span><span class="p">[</span><span class="n">best_index</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">best_score</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;GridSearchCV_results.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/787a7a07c89ab1e52a6d0b0960676f5e5d37f2904a59c6ef5592984757e02f38.png" src="../_images/787a7a07c89ab1e52a6d0b0960676f5e5d37f2904a59c6ef5592984757e02f38.png" />
</div>
</div>
</section>
<section id="final-model">
<h2>Final model<a class="headerlink" href="#final-model" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(5086, 10) (5086,)
(2181, 10) (2181,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfc</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="mi">17</span><span class="p">,</span>
    <span class="n">max_features</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">min_samples_leaf</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="n">oob_score</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># rfc = RandomForestClassifier(n_estimators=250, random_state=1)</span>
<span class="n">rfc</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: black;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: block;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 1ex;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>RandomForestClassifier(max_depth=17, max_features=10, min_samples_leaf=3,
                       n_estimators=50, oob_score=True, random_state=42)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br />On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow fitted">&nbsp;&nbsp;RandomForestClassifier<a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.4/modules/generated/sklearn.ensemble.RandomForestClassifier.html">?<span>Documentation for RandomForestClassifier</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></label><div class="sk-toggleable__content fitted"><pre>RandomForestClassifier(max_depth=17, max_features=10, min_samples_leaf=3,
                       n_estimators=50, oob_score=True, random_state=42)</pre></div> </div></div></div></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span>
<span class="n">importances</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">feature_importances_</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">importances</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">indices</span><span class="p">[:</span><span class="mi">10</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.</span><span class="se">\t</span><span class="s2">#</span><span class="si">{}</span><span class="se">\t</span><span class="si">{:.3f}</span><span class="se">\t</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">importances</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.	#2	0.362	Max Packet Length
2.	#0	0.211	Average Packet Size
3.	#6	0.150	Fwd IAT Std
4.	#3	0.126	Fwd IAT Min
5.	#5	0.054	Total Length of Fwd Packets
6.	#7	0.053	Flow IAT Mean
7.	#9	0.026	Fwd Header Length
8.	#4	0.014	Fwd Packet Length Mean
9.	#8	0.003	Fwd Packet Length Max
10.	#1	0.001	Flow Bytes/s
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y_pred</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[1491,   25],
       [  43,  622]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sklearn.metrics</span> <span class="k">as</span> <span class="nn">metrics</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">precision</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy =&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Precision =&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recall =&quot;</span><span class="p">,</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1 =&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy = 0.9688216414488766
Precision = 0.9613601236476044
Recall = 0.9353383458646617
F1 = 0.948170731707317
</pre></div>
</div>
</div>
</div>
</section>
<section id="model-approbation">
<h2>Model approbation<a class="headerlink" href="#model-approbation" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df_balanced</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s2">&quot;BENIGN&quot;</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Label&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">webattack_features</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y_test</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(7267, 10) (7267,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X_test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Average Packet Size</th>
      <th>Flow Bytes/s</th>
      <th>Max Packet Length</th>
      <th>Fwd IAT Min</th>
      <th>Fwd Packet Length Mean</th>
      <th>Total Length of Fwd Packets</th>
      <th>Fwd IAT Std</th>
      <th>Flow IAT Mean</th>
      <th>Fwd Packet Length Max</th>
      <th>Fwd Header Length</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15</th>
      <td>83.500000</td>
      <td>4.857268e+03</td>
      <td>77</td>
      <td>0.0</td>
      <td>45.000000</td>
      <td>45</td>
      <td>0.000000</td>
      <td>25117.000000</td>
      <td>45</td>
      <td>32</td>
    </tr>
    <tr>
      <th>73</th>
      <td>80.000000</td>
      <td>1.633136e+06</td>
      <td>94</td>
      <td>4.0</td>
      <td>44.000000</td>
      <td>88</td>
      <td>0.000000</td>
      <td>56.333333</td>
      <td>44</td>
      <td>64</td>
    </tr>
    <tr>
      <th>90</th>
      <td>80.000000</td>
      <td>1.380000e+06</td>
      <td>94</td>
      <td>47.0</td>
      <td>44.000000</td>
      <td>88</td>
      <td>0.000000</td>
      <td>66.666667</td>
      <td>44</td>
      <td>64</td>
    </tr>
    <tr>
      <th>140</th>
      <td>414.533333</td>
      <td>5.871577e+06</td>
      <td>1555</td>
      <td>1.0</td>
      <td>345.555556</td>
      <td>3110</td>
      <td>284.408126</td>
      <td>75.642857</td>
      <td>1555</td>
      <td>304</td>
    </tr>
    <tr>
      <th>212</th>
      <td>94.250000</td>
      <td>3.018519e+06</td>
      <td>112</td>
      <td>1.0</td>
      <td>51.000000</td>
      <td>102</td>
      <td>0.000000</td>
      <td>36.000000</td>
      <td>51</td>
      <td>64</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="n">seconds</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">rfc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Total operation time:&quot;</span><span class="p">,</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">seconds</span><span class="p">,</span> <span class="s2">&quot;seconds&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Benign records detected (0), attacks detected (1):&quot;</span><span class="p">)</span>
<span class="n">unique</span><span class="p">,</span> <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y_pred</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">unique</span><span class="p">,</span> <span class="n">counts</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total operation time: 0.010741710662841797 seconds
Benign records detected (0), attacks detected (1):
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{0: 5120, 1: 2147}
</pre></div>
</div>
</div>
</div>
<p>Confusion matrix:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  0  1 - predicted value (Wikipedia uses different convention for axes)
0 TN FP
1 FN TP
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[5035,   52],
       [  85, 2095]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">accuracy</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">precision</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">precision_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">recall</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">recall_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">metrics</span><span class="o">.</span><span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy =&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Precision =&quot;</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recall =&quot;</span><span class="p">,</span> <span class="n">recall</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1 =&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy = 0.9811476537773497
Precision = 0.975780158360503
Recall = 0.9610091743119266
F1 = 0.9683383406517218
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">predict</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Predict&quot;</span><span class="p">:</span> <span class="n">rfc</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)})</span>
<span class="n">label</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Label&quot;</span><span class="p">:</span> <span class="n">y_test</span><span class="p">})</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">predict</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="s2">&quot;The following is point that are predicted to be intrusion (anomaly)&quot;</span><span class="p">)</span>
<span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;Predict&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;The following is point that are predicted to be intrusion (anomaly)&#39;
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Average Packet Size</th>
      <th>Flow Bytes/s</th>
      <th>Max Packet Length</th>
      <th>Fwd IAT Min</th>
      <th>Fwd Packet Length Mean</th>
      <th>Total Length of Fwd Packets</th>
      <th>Fwd IAT Std</th>
      <th>Flow IAT Mean</th>
      <th>Fwd Packet Length Max</th>
      <th>Fwd Header Length</th>
      <th>Label</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>704</th>
      <td>7.500000</td>
      <td>6.000000e+05</td>
      <td>6</td>
      <td>0.0</td>
      <td>6.000000</td>
      <td>6</td>
      <td>0.000000e+00</td>
      <td>1.333333e+01</td>
      <td>6</td>
      <td>20</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>756</th>
      <td>48.000000</td>
      <td>1.134752e+06</td>
      <td>48</td>
      <td>3.0</td>
      <td>32.000000</td>
      <td>64</td>
      <td>0.000000e+00</td>
      <td>4.700000e+01</td>
      <td>32</td>
      <td>64</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1047</th>
      <td>87.500000</td>
      <td>5.073501e+03</td>
      <td>118</td>
      <td>4.0</td>
      <td>38.000000</td>
      <td>76</td>
      <td>0.000000e+00</td>
      <td>2.049867e+04</td>
      <td>38</td>
      <td>40</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1075</th>
      <td>141.000000</td>
      <td>1.098433e+02</td>
      <td>200</td>
      <td>0.0</td>
      <td>41.000000</td>
      <td>41</td>
      <td>0.000000e+00</td>
      <td>2.194035e+06</td>
      <td>41</td>
      <td>32</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>1083</th>
      <td>271.333333</td>
      <td>7.509294e+05</td>
      <td>796</td>
      <td>2.0</td>
      <td>269.333333</td>
      <td>808</td>
      <td>7.580185e+02</td>
      <td>5.380000e+02</td>
      <td>796</td>
      <td>60</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>4591</th>
      <td>146.500000</td>
      <td>3.885334e+03</td>
      <td>183</td>
      <td>0.0</td>
      <td>55.000000</td>
      <td>55</td>
      <td>0.000000e+00</td>
      <td>6.125600e+04</td>
      <td>55</td>
      <td>20</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4600</th>
      <td>80.500000</td>
      <td>1.192036e+04</td>
      <td>101</td>
      <td>3.0</td>
      <td>40.000000</td>
      <td>80</td>
      <td>0.000000e+00</td>
      <td>7.885667e+03</td>
      <td>40</td>
      <td>64</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4709</th>
      <td>87.250000</td>
      <td>6.516699e+03</td>
      <td>119</td>
      <td>3.0</td>
      <td>37.000000</td>
      <td>74</td>
      <td>0.000000e+00</td>
      <td>1.595900e+04</td>
      <td>37</td>
      <td>40</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4855</th>
      <td>104.000000</td>
      <td>1.900135e+03</td>
      <td>108</td>
      <td>0.0</td>
      <td>50.000000</td>
      <td>50</td>
      <td>0.000000e+00</td>
      <td>8.315200e+04</td>
      <td>50</td>
      <td>20</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>4938</th>
      <td>257.538461</td>
      <td>5.846547e+02</td>
      <td>1460</td>
      <td>4.0</td>
      <td>77.125000</td>
      <td>617</td>
      <td>1.965194e+06</td>
      <td>4.772048e+05</td>
      <td>342</td>
      <td>172</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
<p>61 rows × 12 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="s2">&quot;The following is point that are predicted to be genuine&quot;</span><span class="p">)</span>
<span class="n">result</span><span class="p">[</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;Predict&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;The following is point that are predicted to be genuine&#39;
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Average Packet Size</th>
      <th>Flow Bytes/s</th>
      <th>Max Packet Length</th>
      <th>Fwd IAT Min</th>
      <th>Fwd Packet Length Mean</th>
      <th>Total Length of Fwd Packets</th>
      <th>Fwd IAT Std</th>
      <th>Flow IAT Mean</th>
      <th>Fwd Packet Length Max</th>
      <th>Fwd Header Length</th>
      <th>Label</th>
      <th>Predict</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>15</th>
      <td>83.500000</td>
      <td>4.857268e+03</td>
      <td>77</td>
      <td>0.0</td>
      <td>45.000000</td>
      <td>45</td>
      <td>0.000000e+00</td>
      <td>25117.000000</td>
      <td>45</td>
      <td>32</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>73</th>
      <td>80.000000</td>
      <td>1.633136e+06</td>
      <td>94</td>
      <td>4.0</td>
      <td>44.000000</td>
      <td>88</td>
      <td>0.000000e+00</td>
      <td>56.333333</td>
      <td>44</td>
      <td>64</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>90</th>
      <td>80.000000</td>
      <td>1.380000e+06</td>
      <td>94</td>
      <td>47.0</td>
      <td>44.000000</td>
      <td>88</td>
      <td>0.000000e+00</td>
      <td>66.666667</td>
      <td>44</td>
      <td>64</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>140</th>
      <td>414.533333</td>
      <td>5.871577e+06</td>
      <td>1555</td>
      <td>1.0</td>
      <td>345.555556</td>
      <td>3110</td>
      <td>2.844081e+02</td>
      <td>75.642857</td>
      <td>1555</td>
      <td>304</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>212</th>
      <td>94.250000</td>
      <td>3.018519e+06</td>
      <td>112</td>
      <td>1.0</td>
      <td>51.000000</td>
      <td>102</td>
      <td>0.000000e+00</td>
      <td>36.000000</td>
      <td>51</td>
      <td>64</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>7141</th>
      <td>80.000000</td>
      <td>1.308057e+06</td>
      <td>94</td>
      <td>48.0</td>
      <td>44.000000</td>
      <td>88</td>
      <td>0.000000e+00</td>
      <td>70.333333</td>
      <td>44</td>
      <td>40</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7143</th>
      <td>2.400000</td>
      <td>1.538462e+05</td>
      <td>6</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0</td>
      <td>0.000000e+00</td>
      <td>19.500000</td>
      <td>0</td>
      <td>32</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7166</th>
      <td>94.250000</td>
      <td>2.000000e+06</td>
      <td>112</td>
      <td>4.0</td>
      <td>51.000000</td>
      <td>102</td>
      <td>0.000000e+00</td>
      <td>54.333333</td>
      <td>51</td>
      <td>40</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7230</th>
      <td>43.636364</td>
      <td>9.050426e+01</td>
      <td>223</td>
      <td>48.0</td>
      <td>46.142857</td>
      <td>323</td>
      <td>2.126298e+06</td>
      <td>530361.800000</td>
      <td>223</td>
      <td>160</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>7254</th>
      <td>139.000000</td>
      <td>1.533367e+03</td>
      <td>186</td>
      <td>0.0</td>
      <td>46.000000</td>
      <td>46</td>
      <td>0.000000e+00</td>
      <td>151301.000000</td>
      <td>46</td>
      <td>32</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>171 rows × 12 columns</p>
</div></div></div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Module_4_Unsupervised_Learning.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><strong>Module 4</strong>: Unsupervised Learning</p>
      </div>
    </a>
    <a class="right-next"
       href="Module_6_Generative_AI_for_Cyber_Security.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><strong>Module 6:</strong> Generative AI for Cyber Security</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#why-do-we-need-anomaly-detection-in-cyber-security">Why do we need anomaly detection in Cyber Security?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#technical-explanation">Technical Explanation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#real-time-anomaly-detection">Real-Time Anomaly Detection</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#case-study-detecting-intrusion-with-machine-learning">Case Study: Detecting Intrusion with Machine Learning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">Data preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#undersampling-against-unbalance">Undersampling against unbalance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#preparing-data-for-training">Preparing data for training</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importance">Feature importance</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#visualization-of-the-decision-tree-importance-evaluation-using-a-single-tree-decisiontreeclassifier">Visualization of the decision tree, importance evaluation using a single tree (DecisionTreeClassifier)</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#importance-evaluation-using-selectfrommodel">Importance evaluation using SelectFromModel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#evaluation-of-importance-using-randomforestclassifier-feature-importances">Evaluation of importance using RandomForestClassifier.feature_importances_</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-of-selected-features">Analysis of selected features</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hyperparameter-selection">Hyperparameter selection</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#final-model">Final model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-approbation">Model approbation</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By WSU Staffs
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>